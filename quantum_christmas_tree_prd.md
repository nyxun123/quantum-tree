# 量子圣诞树 PRD（电脑端 / 手势交互 / 离线可用）

## 背景与目标
- 圣诞季推出可在 PC 浏览器本地运行的“量子圣诞树”，用手势操控收拢/绽放/光效模式，营造未来感节日氛围。
- 离线可用、隐私安全、低学习成本，默认自动巡航展示，无需鼠标键盘。

## 目标用户与场景
- 桌面端现代浏览器用户（Chrome/Edge/Safari）。
- 场景：办公桌面展示、活动签到屏、家用娱乐；摄像头权限可选。

## 成功标准（验收指标）
- 加载成功率 ≥ 99%，首次渲染 < 4s（本地资源）。
- 交互帧率 ≥ 50fps（1080p，集显），主手势识别准确率 ≥ 90%。
- 无摄像头或拒绝权限时正常展示 2D/自动巡航。

## 用户旅程
- 访问页面 → 权限提示（摄像头，可拒绝） → 自动巡航（默认旋转+光效） → 手势交互（HUD 提示当前识别手势） → 空闲 15s 回巡航。

## 核心需求
- 3D 圣诞树：粒子/线框+发光装饰，顶部星形脉冲光，背景深空雾化。
- 量子态：凝聚态/展开态/超位置态（周期重排）。
- 手势操控：收拢/绽放、旋转、光效主题切换、粒子密度与亮度调节、彩蛋触发。
- 个性化照片：展开/超位置态时在粒子云中穿插用户照片光片，可形成剪影/心形短暂造型。
- HUD 提示：显示当前手势、模式名、帧率/性能模式。
- 声音：环境声（可静音），手势反馈提示音，彩蛋铃铛/烟花音。
- 设置：主题色板、粒子数量、音量、HUD 开关、性能模式（高/低），照片展示开关。
- 降级：无 WebGL → 2D Canvas 雪景+背景图；无摄像头或权限拒绝 → 纯自动巡航并隐藏手势 HUD。

## 手势定义（首选 MediaPipe Hands，本地推理）
- 双手合拢 → 树收拢为光柱；双手展开 → 粒子绽放为树形。
- 单手左右平移（五指张开） → 树体自旋/视角旋转。
- 五指张开静止 1s → 光效主题切换（极光/霓虹/暖金/雪花）。
- 食指画圈 → 粒子重排“量子跃迁”。
- 手掌上推/下压 → 粒子数量与亮度增/减。
- OK 手势 → 彩蛋：烟花+铃铛音。
- 失效保护：连续 3s 无有效手势不改变状态。

## 视觉与动效
- 主题：极光绿/冷蓝为主，暖金点缀；深空背景+体积雾/星尘。
- 粒子：GPU Instancing，微发光、轻景深；树形线框缓慢脉动。
- 状态动画：收拢/绽放 0.8s ease-in-out；超位置态 2s 周期闪跳。
- 背景动效：低频云雾流动；光带环绕树体。

## 前端 UI / 交互设计（PRD 补充）
- 布局：全屏 WebGL Canvas；右上 HUD（模式名/手势提示/帧率/性能模式/静音）；右下设置按钮→侧边抽屉；左上 Logo/标题；底部轻提示条。
- 状态流：加载/权限弹层 → 自动巡航 → 交互（手势驱动） → 空闲 15s 回巡航；低性能/无摄像头/无 WebGL 弹出轻提示并自动降级。
- 权限弹层：说明仅本地处理视频，不上传；按钮“允许摄像头/稍后再说”；拒绝后直接进入自动巡航并隐藏手势 HUD。
- HUD：手势文本提示（如“检测到：双手展开”）、当前模式标签（凝聚/展开/超位置）、帧率计数、性能模式图标、静音切换；在 2D 降级时显示“低配模式”。
- 设置抽屉：主题色板选择（极光/霓虹/暖金/雪花）、粒子数量滑条、亮度滑条、音量滑条、HUD 显示开关、性能模式高/低切换、照片展示开关；一键恢复默认。
- 照片展示控制：开关+“剪影聚合”开关；显示当前正在轮播的文件名/顺序（不暴露路径）；缺图时提示“使用默认纹理”。
- 提示与错误：摄像头不可用/权限拒绝、手势识别超时、性能降级、音频被浏览器拦截（需点击一次交互）；轻提示 3s 自动消失。
- 交互反馈：手势触发时 HUD 边框短暂高亮；彩蛋触发时弹出小彩带/铃铛图标；主题切换时出现 0.5s 渐变遮罩。
- 自适应与缩放：仅桌面端，支持 16:9/16:10/3:2；UI 使用 rem/viewport 单位，确保 13-32 寸屏可读；无移动端布局。
- 资源组织：UI 字体用系统无衬线（SF/Segoe）；图标用内嵌 SVG；不依赖外部 CDN；图片与模型放本地静态目录，可配 Service Worker 预缓存。

## 个性化照片（用户提供）
- 资源：当前目录 `图片/` 下的 JPG/JPEG（已提供 12 张），离线读取。
- 展示策略：展开/超位置态中，照片作为浮动光片（billboard）穿插粒子云；可短暂聚合为剪影/心形后再散开，避免遮挡树顶星。
- 数量与轮播：同时可见 12–16 张以内，随机淡入淡出与缓慢旋转；保证近景对焦，远景加轻雾。
- 处理：前端 Canvas 生成两档纹理（1024px/512px）+缩略图以控内存与带宽；轻量色彩校正（亮度/对比度微调）、渐变蒙版圆角可选。
- 隐私：全部本地加载与处理，不上传；设置中可关闭照片或切换默认贴图；缺图时回退到默认粒子纹理。

## 音频
- 默认环境轻风铃+雪噪；手势反馈短提示音 ≤ 300ms；彩蛋铃铛/烟花音。
- 全局静音开关。

## 技术方案
- 栈：HTML/CSS/JS，Three.js/WebGL 粒子实例化；手势 MediaPipe Hands（本地模型）；Web Audio。
- 资源：尽量内嵌/本地打包，避免网络请求；无外部 CDN 依赖；本地照片统一压缩与缓存（Service Worker 可选）。
- 性能：1080p 目标 60fps，动态粒子上限控制；自适应降级到低配模式（降粒子数、关闭景深/雾）。
- 兼容：Chrome/Edge/Safari 新版；若无 WebGL，切 2D Canvas 雪景。
- 权限：摄像头用途提示与拒绝选项；拒绝后仍可观看自动巡航。

## 状态与 UI 提示
- HUD：当前手势/模式、帧率、性能模式、静音状态。
- 权限弹层：说明仅本地处理，不上传视频。
- 故障提示：识别失败/低性能模式提示条。

## 无障碍与安全
- 高对比 HUD；可关闭强光闪烁；静音模式。
- 隐私：视频流仅本地推理，不存储/上传；显式声明。
- 无摄像头时不循环提示，直接降级。

## 非功能与范围外
- 不接入社交分享、不上传媒体。
- 不做移动端适配（本期 PC 端优先）。

## 数据与埋点（可选，需用户同意）
- 本地计数：手势触发次数/失败率、性能模式切换次数。
- 默认不上传；若需遥测需额外同意。

## 里程碑与验收
- 原型：离线 demo，完成 3 手势（收拢/绽放、旋转、主题切换）。
- Beta：完整手势表、HUD、音频、降级路径。
- RC：性能调优、无摄像头/WebGL 降级验证，指标达标。
- 上线交付：单页 `index.html`（内联依赖），附使用说明与本地照片读取说明。
